generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Movie {
  id                 Int             @id @default(autoincrement())
  title              String
  slug               String          @unique
  contentType        String          @default("movie")
  trending           Boolean         @default(false)
  featured           Boolean         @default(false)
  metaTitle          String?
  metaDescription    String?         @db.Text
  keywords           String?
  year               String?
  rating             Float?
  duration           String?
  synopsis           String?         @db.Text
  posterUrl          String?
  quality            String?
  customQuality      String?
  audioType          String?
  customAudioType    String?
  language           String?
  customLanguage     String?
  subtitle           String?
  customSubtitle     String?
  platform           String?
  isSeries           Boolean         @default(false)
  episodeInfo        String?
  seasonNumber       Int?
  seriesId           String?
  episodesThisSeason Int?
  totalSeasons       Int?
  seriesStatus       String?
  seriesType         String?
  releaseDate        String?
  movieOrigin        String?
  codec              String?
  show4K             Boolean         @default(false)
  views              Int             @default(0)
  isEditorPick       Boolean         @default(false)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  downloads          Download[]
  cast               MovieCast[]
  categories         MovieCategory[]
  genres             MovieGenre[]
  screenshots        Screenshot[]

  @@index([slug])
  @@index([isSeries])
  @@index([seriesId])
  @@index([movieOrigin])
  @@index([platform])
  @@index([trending])
  @@index([featured])
  @@index([isEditorPick])
  @@index([createdAt(sort: Desc)])
  @@index([views(sort: Desc)])
  @@index([rating(sort: Desc)])
  @@map("movies")
}

model Genre {
  id     Int          @id @default(autoincrement())
  name   String       @unique
  movies MovieGenre[]

  @@index([name])
  @@map("genres")
}

model MovieGenre {
  movieId Int
  genreId Int
  genre   Genre @relation(fields: [genreId], references: [id], onDelete: Cascade)
  movie   Movie @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@id([movieId, genreId])
  @@index([genreId])
  @@map("movie_genres")
}

model CastMember {
  id     Int         @id @default(autoincrement())
  name   String
  movies MovieCast[]

  @@index([name])
  @@map("cast_members")
}

model MovieCast {
  movieId Int
  castId  Int
  cast    CastMember @relation(fields: [castId], references: [id], onDelete: Cascade)
  movie   Movie      @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@id([movieId, castId])
  @@index([castId])
  @@map("movie_cast")
}

model Download {
  id            Int      @id @default(autoincrement())
  movieId       Int
  resolution    String
  qualityDetail String?
  size          String?
  link          String?
  batchLink     String?
  batchSize     String?
  order         Int      @default(999)
  createdAt     DateTime @default(now())
  movie         Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@index([movieId])
  @@index([order])
  @@map("downloads")
}

model Screenshot {
  id           Int      @id @default(autoincrement())
  movieId      Int
  url          String
  displayOrder Int?
  createdAt    DateTime @default(now())
  movie        Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@index([movieId])
  @@index([displayOrder])
  @@map("screenshots")
}

model Category {
  id     Int             @id @default(autoincrement())
  name   String          @unique
  slug   String          @unique
  movies MovieCategory[]

  @@index([slug])
  @@map("categories")
}

model MovieCategory {
  movieId    Int
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  movie      Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@id([movieId, categoryId])
  @@index([categoryId])
  @@map("movie_categories")
}
